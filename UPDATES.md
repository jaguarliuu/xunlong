# XunLong 更新说明

## 最新更新 (2025-10-05)

### 🔧 修复

#### 1. Worker日志显示问题
**问题**: 使用`start.py`启动服务时，worker的执行日志被重定向导致看不到
**解决**: 移除了子进程的输出重定向，现在API和Worker的日志都会直接显示在终端

**修改文件**: `start.py`

**重启方式**:
```bash
# 停止当前服务 (Ctrl+C)
# 然后重新启动
python start.py
```

现在你将能看到：
- API服务器的启动日志
- Worker任务执行的详细日志
- 所有进度更新和状态变化

---

### 🎨 前端UI重构

#### 2. 全新首页设计
**新增**: 创建了类似天工AI风格的现代化首页

**特性**:
- 大标题展示区域，带有版本标识
- 四个模式卡片（报告、小说、PPT、任务）
- 点击卡片直接进入对应功能
- 核心特性展示区

**新增文件**: `web/src/components/HomePage.vue`

#### 3. 任务详情页面（左右分栏）
**新增**: 仿照天工AI的任务执行页面，左右分栏显示

**左侧面板 - 执行日志**:
- 实时显示任务执行日志
- 自动/手动滚动切换
- 日志级别高亮（info/success/warning/error）
- 时间戳显示

**右侧面板 - 内容预览**:
- 三种视图模式：渲染视图、Markdown、原始数据
- 实时预览生成的内容
- 任务完成后查看完整结果

**顶部信息栏**:
- 任务标题和元信息
- 状态标签（待处理/执行中/已完成/失败）
- 进度条（执行中时显示）
- 操作按钮（下载、取消等）

**新增文件**: `web/src/components/TaskDetailView.vue`

#### 4. 工作流优化
**改进**: 创建任务后自动跳转到详情页面

**流程**:
1. 在任何生成器页面填写表单
2. 点击生成按钮
3. **立即跳转到任务详情页**（新）
4. 实时查看执行日志和生成进度
5. 任务完成后直接预览和下载

**修改文件**:
- `web/src/components/ReportGenerator.vue`
- `web/src/components/FictionWriter.vue`
- `web/src/components/PPTCreator.vue`
- `web/src/App.vue`

---

## 使用指南

### 启动服务

```bash
# 1. 启动后端服务（API + Worker）
python start.py

# 你会看到类似输出：
# ============================================================
# XunLong 服务启动器
# ============================================================
#
# 正在启动API服务器...
# ✓ API服务器已启动 (PID: 86764)
# 正在启动任务执行器...
# ✓ 任务执行器已启动 (PID: 86803)
#
# ============================================================
# ✅ 所有服务已启动
# ============================================================
#
# 📊 服务信息:
#    API服务器:    http://localhost:8000
#    API文档:      http://localhost:8000/docs
#    健康检查:     http://localhost:8000/health
```

```bash
# 2. 启动前端（新终端）
cd web
npm run dev

# 访问: http://localhost:5173
```

### 使用Web界面

#### 方式1：从首页开始
1. 打开 http://localhost:5173
2. 在首页点击对应的模式卡片
3. 填写表单并提交
4. 自动跳转到任务详情页

#### 方式2：从导航菜单
1. 使用顶部导航栏切换功能
2. 报告/小说/PPT：创建新任务
3. 任务：查看所有任务列表

#### 任务详情页面操作
- **左侧日志面板**:
  - 查看实时执行日志
  - 点击"自动滚动"切换滚动模式
  - 不同级别的日志会以不同颜色显示

- **右侧内容面板**:
  - 切换视图模式查看内容
  - 任务完成后可预览结果
  - 点击下载按钮获取文件

- **顶部操作**:
  - 返回：回到任务列表
  - 下载结果：任务完成后可用
  - 取消任务：运行中的任务可取消

---

## 技术细节

### 后端
- FastAPI 异步API服务器
- 独立的任务Worker进程
- 基于文件的任务队列系统
- 实时进度追踪

### 前端
- Vue 3 Composition API
- 组件化设计
- 实时轮询更新
- 响应式布局

### 日志系统
前端模拟日志系统，基于任务状态更新：
- 自动记录任务状态变化
- 显示进度步骤信息
- 错误信息高亮显示
- 限制日志数量防止内存溢出

---

## 目录结构

```
XunLong/
├── start.py              # 统一启动脚本（已修复）
├── run_api.py           # API服务器
├── start_worker.py      # Worker启动器
├── src/
│   ├── api.py           # API路由定义
│   ├── task_manager.py  # 任务管理器
│   └── task_worker.py   # 任务执行器
└── web/
    ├── src/
    │   ├── App.vue              # 主应用（路由逻辑）
    │   ├── components/
    │   │   ├── HomePage.vue         # 首页（新）
    │   │   ├── TaskDetailView.vue   # 任务详情页（新）
    │   │   ├── ReportGenerator.vue  # 报告生成器
    │   │   ├── FictionWriter.vue    # 小说创作器
    │   │   ├── PPTCreator.vue       # PPT生成器
    │   │   └── TaskMonitor.vue      # 任务监控
    │   └── api/
    │       └── index.js         # API客户端
    └── package.json
```

---

## 注意事项

1. **Worker日志**: 现在可以在启动`start.py`的终端中看到所有日志
2. **任务详情**: 创建任务后会自动跳转，无需手动查找
3. **实时更新**: 任务详情页每2秒自动刷新状态
4. **日志模拟**: 前端日志是基于任务状态模拟的，不是真正的后端日志
5. **真实日志**: 后端真实执行日志在终端中查看

---

## 下一步计划

- [ ] WebSocket支持，实现真正的实时日志推送
- [ ] 更多主题和样式选项
- [ ] 任务历史和统计
- [ ] 导出格式优化
- [ ] 移动端适配

---

## 反馈

如有问题或建议，请访问：
- GitHub Issues: https://github.com/jaguarliuu/xunlong/issues
